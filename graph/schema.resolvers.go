package graph

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.31

import (
	"context"

	"inverse.so/engine/aiimages"
	"inverse.so/engine/collections"
	"inverse.so/engine/items"
	"inverse.so/engine/onboarding"
	"inverse.so/graph/model"
	"inverse.so/internal"
	"inverse.so/internal/customError"
	"inverse.so/structure"
)

// Items is the resolver for the items field.
func (r *collectionResolver) Items(ctx context.Context, obj *model.Collection) ([]*model.Item, error) {
	return items.FetchCollectionItems(obj.ID, nil)
}

// RegisterInverseUsername is the resolver for the registerInverseUsername field.
func (r *mutationResolver) RegisterInverseUsername(ctx context.Context, input model.NewUsernameRegisgration) (*model.CreatorDetails, error) {
	authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	return onboarding.RegisterInverseUsername(authenticationDetails.Address, &input)
}

// CreateCollection is the resolver for the createCollection field.
func (r *mutationResolver) CreateCollection(ctx context.Context, input model.CollectionInput) (*model.Collection, error) {
	authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	return collections.CreateCollection(&input, authenticationDetails)
}

// UpdateCollection is the resolver for the updateCollection field.
func (r *mutationResolver) UpdateCollection(ctx context.Context, collectionID string, input model.CollectionInput) (*model.Collection, error) {
	authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	return collections.UpdateCollection(collectionID, &input, authenticationDetails)
}

// CreateItem is the resolver for the createItem field.
func (r *mutationResolver) CreateItem(ctx context.Context, input model.ItemInput) (*model.Item, error) {
	authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	return items.CreateItem(&input, authenticationDetails)
}

// UpdateItem is the resolver for the updateItem field.
func (r *mutationResolver) UpdateItem(ctx context.Context, itemID string, input model.ItemInput) (*model.Item, error) {
	authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	return items.UpdateItem(itemID, &input, authenticationDetails)
}

// GetCreatorDetails is the resolver for the getCreatorDetails field.
func (r *queryResolver) GetCreatorDetails(ctx context.Context) (*model.CreatorDetails, error) {
	authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	creatorInfo, err := onboarding.CreateCreatorProfileIfAddressIsMissing(authenticationDetails.Address)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	return creatorInfo.ToGraphData(), nil
}

// GetOnboardinProgress is the resolver for the getOnboardinProgress field.
func (r *queryResolver) GetOnboardinProgress(ctx context.Context) (*model.OnboardingProgress, error) {
	authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	onbaordingInfo, err := onboarding.GetOnboardinProgress(authenticationDetails.Address)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	return onbaordingInfo, nil
}

// IsInverseNameIsAvailable is the resolver for the isInverseNameIsAvailable field.
func (r *queryResolver) IsInverseNameIsAvailable(ctx context.Context, input model.NewUsernameRegisgration) (bool, error) {
	return onboarding.CheckIfInverseNameIsAvailable(&input)
}

// FetchCollectionByID is the resolver for the fetchCollectionById field.
func (r *queryResolver) FetchCollectionByID(ctx context.Context, collectionID string) (*model.Collection, error) {
	return collections.FetchCollectionByID(collectionID)
}

// FetchCreatorCollections is the resolver for the fetchCreatorCollections field.
func (r *queryResolver) FetchCreatorCollections(ctx context.Context) ([]*model.Collection, error) {
	authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	if err != nil {
		return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	}

	return collections.FetchCreatorCollections(authenticationDetails)
}

// FetchItemsInCollection is the resolver for the fetchItemsInCollection field.
func (r *queryResolver) FetchItemsInCollection(ctx context.Context, collectionID string) ([]*model.Item, error) {
	// authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	// if err != nil {
	// 	return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	// }

	return items.FetchCollectionItems(collectionID, nil)
}

// FetchItemByID is the resolver for the fetchItemById field.
func (r *queryResolver) FetchItemByID(ctx context.Context, itemID string) (*model.Item, error) {
	return items.FetchItemByID(itemID)
}

// GetImageSuggestions is the resolver for the getImageSuggestions field.
func (r *queryResolver) GetImageSuggestions(ctx context.Context, prompt string, preset *model.AiImageStyle) ([]string, error) {
	// authenticationDetails, err := internal.GetAuthDetailsFromContext(ctx)
	// if err != nil {
	// 	return nil, customError.ErrToGraphQLError(structure.InverseInternalError, err.Error(), ctx)
	// }
	return aiimages.GetImageSuggestions(prompt, preset)
}

// Collection returns CollectionResolver implementation.
func (r *Resolver) Collection() CollectionResolver { return &collectionResolver{r} }

// Mutation returns MutationResolver implementation.
func (r *Resolver) Mutation() MutationResolver { return &mutationResolver{r} }

// Query returns QueryResolver implementation.
func (r *Resolver) Query() QueryResolver { return &queryResolver{r} }

type collectionResolver struct{ *Resolver }
type mutationResolver struct{ *Resolver }
type queryResolver struct{ *Resolver }
